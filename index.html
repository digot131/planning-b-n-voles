<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Planning b√©n√©voles</title>

<style>
body{
  font-family: system-ui;
  background:#f0f2f5;
  margin:0;
}

header{
  background:#111827;
  color:white;
  padding:15px;
  font-size:20px;
  font-weight:bold;
}

.day{
  margin:15px;
}

.day h2{
  margin:10px 0;
}

.slot{
  background:white;
  border-radius:12px;
  padding:12px;
  margin:10px 0;
  box-shadow:0 2px 8px rgba(0,0,0,.08);
}

.cat{
  padding:4px 8px;
  border-radius:8px;
  font-size:12px;
  font-weight:bold;
  color:white;
}

.bar{background:#f97316;}
.restauration{background:#16a34a;}
.caisse{background:#2563eb;}
.montage{background:#7c3aed;}
.demontage{background:#6b7280;}
.blindtest{background:#ec4899;}

button{
  margin-top:8px;
  padding:8px 12px;
  border:none;
  border-radius:8px;
  background:#111827;
  color:white;
  cursor:pointer;
}

.full{
  opacity:.5;
}

.count{
  font-size:13px;
  color:#555;
}
</style>
</head>

<body>

<header>Planning des b√©n√©voles</header>
<div id="planning"></div>

<script>
const SHEET_JSON = "https://opensheet.elk.sh/1YKohHlGSwkaSHxwk6Yt3uhRNzIrQUU7hEsfOygncnE4/planning";
const API = "COLLE_TON_URL_SCRIPT";

const colorClass = cat=>{
  cat=cat.toLowerCase();
  if(cat.includes("bar")) return "bar";
  if(cat.includes("rest")) return "restauration";
  if(cat.includes("caisse")) return "caisse";
  if(cat.includes("montage")) return "montage";
  if(cat.includes("d√©mont")||cat.includes("demont")) return "demontage";
  if(cat.includes("blind")) return "blindtest";
  return "";
}

async function loadPlanning(){
  const res = await fetch(SHEET_JSON);
  const data = await res.json();
  const container=document.getElementById("planning");
  container.innerHTML="";

  const days=[...new Set(data.map(r=>r.jour))];

  days.forEach(day=>{
    const section=document.createElement("div");
    section.className="day";
    section.innerHTML=`<h2>${day}</h2>`;

    data.filter(r=>r.jour===day).forEach(r=>{
      const inscrits=parseInt(r.inscrits||0);
      const besoin=parseInt(r.besoin||0);
      const full=inscrits>=besoin;

      const div=document.createElement("div");
      div.className="slot "+(full?"full":"");

      div.innerHTML=`
        <b>${r.debut} - ${r.fin}</b><br>
        <span class="cat ${colorClass(r.categorie)}">${r.categorie}</span>
        <div class="count">${inscrits}/${besoin} b√©n√©voles</div>
        ${full?"<i>Complet</i>":`<button onclick='demande(${JSON.stringify(r)})'>Demander</button>`}
      `;

      section.appendChild(div);
    });

    container.appendChild(section);
  });
}

function demande(slot){
  const nom=prompt("Ton nom ?");
  if(!nom) return;
  const tel=prompt("Ton t√©l√©phone ?");
  if(!tel) return;

  fetch(API,{
    method:"POST",
    body:JSON.stringify({...slot,nom,tel})
  });

  alert("Merci ! On te confirme rapidement üëç");
}

loadPlanning();
</script>

</body>
</html>


